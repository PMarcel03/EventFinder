<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EventFinder - Discover Local Events</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #8b5cf6;
            --primary-dark: #7c3aed;
            --secondary-color: #06b6d4;
            --accent-color: #f59e0b;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --bg-color: #fafafa;
            --surface-color: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            --border-color: #e5e7eb;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --gradient: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* Vue App Structure */
        #app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header Component */
        .header {
            background: var(--gradient);
            color: white;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-lg);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.75rem;
            font-weight: 800;
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo::before {
            content: "üé™";
            font-size: 1.5rem;
        }

        .nav {
            display: flex;
            gap: 1.5rem;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-link:hover,
        .nav-link.router-link-active {
            color: white;
            background-color: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .location-indicator {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.8);
        }

        /* Main Content Area - Vue Router View */
        .main-content {
            flex: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            width: 100%;
        }

        /* Vue Component Base Styles */
        .page-view {
            min-height: 400px;
        }

        .page-header {
            margin-bottom: 2rem;
            text-align: center;
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-subtitle {
            color: var(--text-secondary);
            font-size: 1.2rem;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Card Components for Vue */
        .card {
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-body {
            padding: 1.5rem;
        }

        .card-footer {
            padding: 1rem 1.5rem;
            background-color: #f9fafb;
            border-top: 1px solid var(--border-color);
        }

        /* Button Components */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--gradient);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background-color: var(--surface-color);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline {
            background-color: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        /* Form Components for Vue */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.875rem;
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgb(139 92 246 / 0.1);
        }

        .search-bar {
            position: relative;
            max-width: 500px;
            margin: 2rem auto;
        }

        .search-input {
            width: 100%;
            padding: 1rem 3rem 1rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 2rem;
            font-size: 1.1rem;
            box-shadow: var(--shadow);
        }

        .search-btn {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            background: var(--gradient);
            color: white;
            border: none;
            border-radius: 50%;
            width: 2.5rem;
            height: 2.5rem;
            cursor: pointer;
        }

        /* Event Card Components */
        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .event-card {
            background: var(--surface-color);
            border-radius: 1rem;
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .event-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-4px);
        }

        .event-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
        }

        .event-content {
            padding: 1.5rem;
        }

        .event-date {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background-color: #fef3c7;
            color: #92400e;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .event-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .event-description {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .event-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .event-location,
        .event-price {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .event-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .tag {
            padding: 0.25rem 0.75rem;
            background-color: #e0e7ff;
            color: var(--primary-color);
            border-radius: 9999px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        /* Filter Components */
        .filters-bar {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        /* Stats/Categories Component */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .category-card {
            background: var(--surface-color);
            border: 2px solid var(--border-color);
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .category-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .category-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .category-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .category-count {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        /* Loading & Empty States */
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem;
        }

        .spinner {
            width: 2rem;
            height: 2rem;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        /* Vue Transition Classes */
        .fade-enter-active,
        .fade-leave-active {
            transition: opacity 0.3s ease;
        }

        .fade-enter-from,
        .fade-leave-to {
            opacity: 0;
        }

        .slide-enter-active,
        .slide-leave-active {
            transition: transform 0.3s ease;
        }

        .slide-enter-from {
            transform: translateX(100%);
        }

        .slide-leave-to {
            transform: translateX(-100%);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }

            .nav {
                order: -1;
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }

            .main-content {
                padding: 1rem;
            }

            .page-title {
                font-size: 2rem;
            }

            .events-grid {
                grid-template-columns: 1fr;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            .categories-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: var(--surface-color);
            border-radius: 1rem;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 2.5rem;
            height: 2.5rem;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: all 0.2s ease;
            color: var(--text-primary);
        }

        .modal-close:hover {
            background: white;
            transform: scale(1.1);
        }

        .modal-body {
            padding: 2rem;
        }

        /* Prevent body scroll when modal is open */
        body.modal-open {
            overflow: hidden;
        }

        /* Utility Classes for Vue */
        .hidden { display: none; }
        .visible { display: block; }
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
    </style>
</head>
<body>
    <div id="app">
        <!-- Header Component (HeaderComponent.vue) -->
        <header class="header">
            <div class="header-content">
                <a href="#/" class="logo">EventFinder</a>
                
                <nav class="nav">
                    <a href="#/" class="nav-link">Home</a>
                    <a href="#/favorites" class="nav-link">My Favorites</a>
                    <a href="#/create" class="nav-link" style="background-color: rgba(255, 255, 255, 0.2); font-weight: 600;">+ Create Event</a>
                </nav>

                <div class="user-menu">
                    <div class="location-indicator">
                        üìç Auckland, NZ
                    </div>
                    <button class="btn btn-secondary btn-small">Sign In</button>
                </div>
            </div>
        </header>
  
        <!-- Main Content (Router View) -->
        <main class="main-content">
            <!-- Home View Component -->
            <div class="page-view" id="home-view">
                <div class="page-header">
                    <h1 class="page-title">Discover Amazing Local Events</h1>
                    <p class="page-subtitle">Find concerts, workshops, festivals, and more happening near you</p>
                </div>
                 <!-- Selected Category Banner -->
                  <div v-if="displayMode.isFiltered" class="mb-2" style="text-align: center; margin-bottom: 1rem;">
                    <span v-if="selectedCategory" class="tag" style="font-size: 1rem; padding: 0.5rem 1rem;">
                        üìÇ Filtered by: {{ selectedCategory }}
                    </span>
                    <span v-else-if="searchQuery" class="tag" style="font-size: 1rem; padding: 0.5rem 1rem;">
                        üîç Search results for: "{{ searchQuery }}"
                    </span>
                    <span v-else-if="displayMode.current === 'filtered'" class="tag" style="font-size: 1rem; padding: 0.5rem 1rem;">
                        ‚öôÔ∏è Advanced Filters Active
                    </span>
                    
                    <button @click="clearAllFilters" class="btn btn-small btn-outline" style="margin-left: 1rem;">
                        {{ displayMode.default === 'upcoming' ? 'Show Upcoming ‚úï' : 'Show This Week ‚úï' }}
                    </button>
                </div>
              
            <div v-else-if="showAllEvents" class="mb-2" style="text-align: center; margin-bottom: 1rem;">
                <span class="tag" style="font-size: 1rem; padding: 0.5rem 1rem; background-color: #dbeafe; color: #1e40af;">
                    üìÖ Showing all events
                </span>
                
                <button @click="clearAllFilters" class="btn btn-small btn-outline" style="margin-left: 1rem;">
                    {{ displayMode.default === 'upcoming' ? 'Show Upcoming ‚úï' : 'Show This Week ‚úï' }}
                </button>
            </div>
            <div v-else class="mb-2" style="text-align: center; margin-bottom: 1rem;">
                <span v-if="displayMode.current === 'this-week'" class="tag" style="font-size: 1rem; padding: 0.5rem 1rem; background-color: #d8c7fe; color: #240e92;">
                    üìÖ Showing events this week ({{ getThisWeekDates().startDate.split('T')[0] }} - {{ getThisWeekDates().endDate.split('T')[0] }})
                </span>
                <span v-else-if="displayMode.current === 'upcoming'" class="tag" style="font-size: 1rem; padding: 0.5rem 1rem; background-color: #dbeafe; color: #1e3a8a;">
                    üîÆ Showing upcoming events
                </span>
                <button @click="viewAllEvents" class="btn btn-small btn-outline" style="margin-left: 1rem;">
                    View All Events üìÖ
                </button>
            </div>
               

                <!-- Search Component -->
                <div class="search-bar">
                    <input type="text" 
                           class="search-input" 
                           placeholder="Search events, venues, or organizers..."
                           v-model="searchQuery">
                    <button class="search-btn">üîç</button>
                </div>


                <!-- Categories Component -->
                <div class="categories-grid">
                    <div class="category-card" @click="filterByCategory('Music & Concerts')">
                        <span class="category-icon">üéµ</span>
                        <div class="category-name">Music & Concerts</div>
                        <div class="category-count">24 events</div>
                    </div>
                    <div class="category-card" @click="filterByCategory('Arts & Culture')">
                        <span class="category-icon">üé®</span>
                        <div class="category-name">Arts & Culture</div>
                        <div class="category-count">18 events</div>
                    </div>
                    <div class="category-card" @click="filterByCategory('Food & Drink')">
                        <span class="category-icon">üçï</span>
                        <div class="category-name">Food & Drink</div>
                        <div class="category-count">31 events</div>
                    </div>
                    <div class="category-card" @click="filterByCategory('Sports & Fitness')">
                        <span class="category-icon">üèÉ‚Äç‚ôÇÔ∏è</span>
                        <div class="category-name">Sports & Fitness</div>
                        <div class="category-count">15 events</div>
                    </div>
                    <div class="category-card" @click="filterByCategory('Business & Tech')">
                        <span class="category-icon">üíº</span>
                        <div class="category-name">Business & Tech</div>
                        <div class="category-count">12 events</div>
                    </div>
                    <div class="category-card" @click="filterByCategory('Family & Kids')">
                        <span class="category-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                        <div class="category-name">Family & Kids</div>
                        <div class="category-count">22 events</div>
                    </div>
                </div>
                <div class ="events-grid">
                    <!--Loading State-->
                    <div v-if="loading" class="loading-spinner">
                        <div class="spinner"></div>
                    </div>

                    <!--Error State-->
                    <div v-else-if="error" class="empty-state">
                        <div class="empty-state-icon">‚ö†Ô∏è</div>
                        <p>Error loading events: {{error}}</p>
                    </div>

                    <!--Empty State-->
                    <div v-else-if="events.length === 0" class ="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <p>No events found</p>
                    </div>

                    <!--Event Cards-->
                    <div v-else v-for="event in filteredEvents" :key="event._id" class="event-card">
                        <div class="event-image">{{getCategoryEmoji(event.category)}}</div>
                        <div class="event-content">
                            <div class="event-date">üìÖ {{formatDate(event.dateTime)}}</div>
                            <h3 class="event-title">{{event.title}}</h3>
                            <p class="event-description">{{event.description || 'No description avaliable'}}</p>
                            <div class="event-meta">
                                <div class="event-location">üìç {{getLocation(event.location)}}</div>
                                <div class="event-price">üí∞ {{getPrice(event.pricing)}}</div>
                            </div>
                            <div class="event-tags">
                                <span class="tag">{{event.category}}</span>
                            </div>
                            <button class="btn btn-primary" @click="viewEvent(event._id)">View Details</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Create Event View -->
            <div class="page-view" id="create-event-view" v-show="currentRoute === '/create'">
                <div class="page-header">
                    <h1 class="page-title">Create New Event</h1>
                    <p class="page-subtitle">Share your event with the Auckland community</p>
                </div>

                <div class="card" style="max-width: 800px; margin: 0 auto;">
                    <div class="card-body">
                        <form @submit.prevent="submitEvent">
                            <div class="form-group">
                                <label class="form-label">Event Title *</label>
                                <input type="text" class="form-input" v-model="newEvent.title" required placeholder="e.g., Summer Music Festival">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <textarea class="form-textarea" v-model="newEvent.description" rows="4" placeholder="Tell people about your event..."></textarea>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Category *</label>
                                <select class="form-select" v-model="newEvent.category" required>
                                    <option value="">Select a category</option>
                                    <option>Music & Concerts</option>
                                    <option>Arts & Culture</option>
                                    <option>Food & Drink</option>
                                    <option>Sports & Fitness</option>
                                    <option>Business & Tech</option>
                                    <option>Family & Kids</option>
                                </select>
                            </div>

                            <div class="form-group">
                                    <label class="form-label">Event Date *</label>
                                    <input type="date" class="form-input" v-model="newEvent.date" required>
                            </div>
                                <div class="form-group">
                                    <label class="form-label">Event Time *</label>
                                    <input type="time" class="form-input" v-model="newEvent.time" required>
                                </div>

                            <div class="form-group">
                                <label class="form-label">Venue Name *</label>
                                <input type="text" class="form-input" v-model="newEvent.venueName" required placeholder="e.g., Western Springs Stadium">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Organizer Name *</label>
                                <input type="text" class="form-input" v-model="newEvent.organizerName" required placeholder="e.g., Auckland Live Events">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Is this a free event?</label>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" v-model="newEvent.isFree" id="isFree">
                                    <label for="isFree" style="margin: 0; font-weight: normal;">Yes, this event is free</label>
                                </div>
                            </div>

                            <div class="form-group" v-if="!newEvent.isFree">
                                <label class="form-label">Price Range</label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div>
                                        <input type="number" class="form-input" v-model.number="newEvent.minPrice" placeholder="Min Price ($)" min="0">
                                    </div>
                                    <div>
                                        <input type="number" class="form-input" v-model.number="newEvent.maxPrice" placeholder="Max Price ($)" min="0">
                                    </div>
                                </div>
                            </div>

                            <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                                <button type="submit" class="btn btn-primary" :disabled="submitting">
                                    {{ submitting ? 'Creating...' : 'Create Event üéâ' }}
                                </button>
                                <button type="button" class="btn btn-secondary" @click="cancelCreate">
                                    Cancel
                                </button>
                            </div>

                            <div v-if="submitError" class="mt-2" style="color: var(--danger-color); font-weight: 600;">
                                {{ submitError }}
                            </div>
                            <div v-if="submitSuccess" class="mt-2" style="color: var(--success-color); font-weight: 600;">
                                ‚úì Event created successfully!
                            </div>
                        </form>
                    </div>
                </div>
            </div>
                <!-- Filters Component -->
                <div class="filters-bar">
                    <div class="filters-grid">
                        <div class="form-group">
                            <label class="form-label">Date Range</label>
                            <select class="form-select" v-model="filters.dateRange">
                                <option value="all">All Dates</option>
                                <option value="today">Today</option>
                                <option value="tomorrow">Tomorrow</option>
                                <option value="this-weekend">This Weekend</option>
                                <option value="next-week">Next Week</option>
                                <option value="this-month">This Month</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Price Range</label>
                            <select class="form-select" v-model="filters.priceRange">
                                <option value="all">All Prices</option>
                                <option value="free">Free</option>
                                <option value="under-25">Under $25</option>
                                <option value="25-50">$25 - $50</option>
                                <option value="50-100">$50 - $100</option>
                                <option value="over-100">$100+</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Location</label>
                            <input type="text" class="form-input" v-model="filters.locationQuery" placeholder="Enter suburb or venue">
                        </div>
                        <div class="form-group" style="display: flex; align-items: flex-end;">
                            <button @click="clearAdvancedFilters" class="btn btn-outline" style="width: 100%;">
                                Clear Filters
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Event Detail Modal -->
                <div v-if="selectedEvent" class="modal-overlay" @click="closeEventDetail">
                    <div class="modal-content" @click.stop>
                        <button class="modal-close" @click="closeEventDetail">‚úï</button>
                        
                        <div class="event-image" style="height: 250px;">
                            {{ getCategoryEmoji(selectedEvent.category) }}
                        </div>
                        
                        <div class="modal-body">
                            <div class="event-date mb-2">üìÖ {{ formatDate(selectedEvent.dateTime) }}</div>
                            <h1 class="event-title" style="font-size: 2rem;">{{ selectedEvent.title }}</h1>
                            
                            <div class="event-meta mb-3" style="justify-content: flex-start; gap: 2rem;">
                                <div class="event-location">üìç {{ getLocation(selectedEvent.location) }}</div>
                                <div class="event-price">üí∞ {{ getPrice(selectedEvent.pricing) }}</div>
                            </div>
                            
                            <div class="event-tags mb-3">
                                <span class="tag">{{ selectedEvent.category }}</span>
                            </div>
                            
                            <div class="mb-3">
                                <h3 style="margin-bottom: 0.5rem; font-size: 1.1rem;">About this event</h3>
                                <p class="event-description">
                                    {{ selectedEvent.description || 'No description available.' }}
                                </p>
                            </div>
                            
                            <div v-if="selectedEvent.organizer" class="mb-3">
                                <h3 style="margin-bottom: 0.5rem; font-size: 1.1rem;">Organizer</h3>
                                <p style="color: var(--text-secondary);">
                                    {{ selectedEvent.organizer.name || 'Organizer information not available' }}
                                </p>
                            </div>
                            
                            <div v-if="selectedEvent.location?.venueId" class="mb-3">
                                <h3 style="margin-bottom: 0.5rem; font-size: 1.1rem;">Venue Details</h3>
                                <p style="color: var(--text-secondary);">
                                    <strong>{{ selectedEvent.location.venueId.name }}</strong><br>
                                    <span v-if="selectedEvent.location.venueId.address">
                                        {{ selectedEvent.location.venueId.address.street }}<br>
                                        {{ selectedEvent.location.venueId.address.suburb }}, {{ selectedEvent.location.venueId.address.city }}
                                    </span>
                                </p>
                            </div>
                            
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                <button class="btn btn-primary">Add to Favorites ‚ù§Ô∏è</button>
                                <button class="btn btn-secondary">Share Event üì§</button>
                                <button class="btn btn-outline">Get Directions üó∫Ô∏è</button>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
            </div>

        </main>
    </div>

<script>
const {createApp, computed} = Vue;

createApp({
    data() {
        return {
            events: [],
            loading: true,
            error: null,
            searchQuery: '',
            currentRoute: window.location.hash.slice(1) || '/',
            selectedCategory: null,
            showAllEvents: false,
            selectedEvent: null,
            submitting: false,
            submitError: null,
            submitSuccess: false,
            filters: {
                dateRange: 'all',
                priceRange: 'all',
                locationQuery: ''

            },
            newEvent: {
                title: '',
                description: '',
                category: '',
                dateTime: '',
                venueName: '',
                organizerName: '',
                isFree: false,
                minPrice: null,
                maxPrice: null
            }
        }
    },
    async mounted() {
       //--- ROUTING SETUP ---
       //Listen for hash changes (e.g when a user clicks a nav link)
       window.addEventListener('hashchange', () => {
        this.currentRoute = window.location.hash.slice(1) || '/'
       });

       //Close modal on esc key
       window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && this.selectedEvent){
            this.closeEventDetail();
        }
       })

       //--- DATA FETCHING ---
    await this.fetchEvents();
    },

    computed: {
        currentview(){
            //Maps hash path to an element ID/Name to be displayed
            if (this.currentRoute === '' || this.currentRoute === '/' || this.currentRoute.startsWith('/events')) return 'home-view';
            //if (this.currentRoute.startsWith('/events')) return 'events-view';
            //if (this.currentRoute.startsWith('/categories')) return 'categories-view';
            if (this.currentview.startsWith('/favourites')) return 'favourites-view';

            //Fallback: Could be a dedicated 404 view
            return 'home-view';
        },

        filteredEvents() {
        let events = this.events;
        console.log('Starting with events:', events.length);

        // 1. Category filter (from category cards)
        if (this.selectedCategory) {
            events = events.filter(event => event.category === this.selectedCategory);
        }
        
        // 2. Search query filter
        if (this.searchQuery && this.searchQuery.trim() !== '') {
            const search = this.searchQuery.toLowerCase();
            events = events.filter(event =>
                event.title.toLowerCase().includes(search) ||
                (event.description && event.description.toLowerCase().includes(search)) ||
                (event.location?.venueName && event.location.venueName.toLowerCase().includes(search))
            );
        }
        
        // 3. Location filter
        if (this.filters.locationQuery && this.filters.locationQuery.trim() !== '') {
            const location = this.filters.locationQuery.toLowerCase();
            events = events.filter(event =>
                (event.location?.venueName && event.location.venueName.toLowerCase().includes(location)) ||
                (event.location?.address?.suburb && event.location.address.suburb.toLowerCase().includes(location)) ||
                (event.location?.address?.city && event.location.address.city.toLowerCase().includes(location))
            );
        }
        
        // 4. Price range filter
        if (this.filters.priceRange !== 'all') {
            events = events.filter(event => {
                const pricing = event.pricing;
                
                if (this.filters.priceRange === 'free') {
                    return pricing?.isFree === true;
                }
                
                // For paid events, check min/max price
                const minPrice = pricing?.minPrice || 0;
                const maxPrice = pricing?.maxPrice || minPrice;
                
                switch(this.filters.priceRange) {
                    case 'under-25':
                        return !pricing?.isFree && maxPrice < 25;
                    case '25-50':
                        return !pricing?.isFree && minPrice >= 25 && maxPrice <= 50;
                    case '50-100':
                        return !pricing?.isFree && minPrice >= 50 && maxPrice <= 100;
                    case 'over-100':
                        return !pricing?.isFree && minPrice >= 100;
                    default:
                        return true;
                }
            });
        }
        
        // 5. Date range filter
        if (this.filters.dateRange !== 'all') {
            const now = new Date();
            now.setHours(0, 0, 0, 0);
            
            events = events.filter(event => {
                if (!event.dateTime || !event.dateTime.start) return false;
                
                const eventDate = new Date(event.dateTime.start);
                eventDate.setHours(0, 0, 0, 0);
                
                switch(this.filters.dateRange) {
                    case 'today':
                        return eventDate.getTime() === now.getTime();
                        
                    case 'tomorrow':
                        const tomorrow = new Date(now);
                        tomorrow.setDate(tomorrow.getDate() + 1);
                        return eventDate.getTime() === tomorrow.getTime();
                        
                    case 'this-weekend':
                        const dayOfWeek = now.getDay();
                        const daysUntilSaturday = (6 - dayOfWeek + 7) % 7;
                        const saturday = new Date(now);
                        saturday.setDate(saturday.getDate() + daysUntilSaturday);
                        const sunday = new Date(saturday);
                        sunday.setDate(sunday.getDate() + 1);
                        return eventDate.getTime() === saturday.getTime() || 
                            eventDate.getTime() === sunday.getTime();
                        
                    case 'next-week':
                        const nextWeekStart = new Date(now);
                        nextWeekStart.setDate(nextWeekStart.getDate() + 7);
                        const nextWeekEnd = new Date(nextWeekStart);
                        nextWeekEnd.setDate(nextWeekEnd.getDate() + 7);
                        return eventDate >= nextWeekStart && eventDate < nextWeekEnd;
                        
                    case 'this-month':
                        return eventDate.getMonth() === now.getMonth() && 
                            eventDate.getFullYear() === now.getFullYear();
                        
                    default:
                        return true;
                }
            });
        }
        
        // 6. If "View All Events" is active and no other filters, show everything
        if (this.showAllEvents && 
            !this.selectedCategory && 
            !this.searchQuery && 
            !this.filters.locationQuery &&
            this.filters.dateRange === 'all' &&
            this.filters.priceRange === 'all') {
            return events;
        }
        
        // 7. Default: show only "this week" events (if no filters are active)
        if (!this.selectedCategory && 
            !this.searchQuery && 
            !this.filters.locationQuery &&
            this.filters.dateRange === 'all' &&
            this.filters.priceRange === 'all' &&
            !this.showAllEvents) {
            
            const dates = this.getThisWeekDates();
            const today = new Date(dates.startDate);
            const endOfWeek = new Date(dates.endDate);
            
            const thisWeekEvents = events.filter(event => {  // Fixed: was missing 'const thisWeekEvents ='
                if (!event.dateTime || !event.dateTime.start) {
                    return false;
                }
                const eventDate = new Date(event.dateTime.start);
                return eventDate >= today && eventDate <= endOfWeek;
            });

            // If no events this week, show upcoming events instead
            if (thisWeekEvents.length === 0) {  // Fixed: was 'getThisWeekDates.length'
                console.log('No events this week, showing all upcoming events');
                events = events.filter(event => {
                    if (!event.dateTime || !event.dateTime.start) return false;
                    const eventDate = new Date(event.dateTime.start);  // Fixed: was 'new date' (lowercase d)
                    return eventDate >= today; // Show all future events
                });
            } else {
                events = thisWeekEvents;
            }
        }

        console.log('Filtered events count:', events.length);
        return events;
        },

      displayMode() {
        // 1. Determine the "Default View" (what happens when no filters are active)
        const dates = this.getThisWeekDates();
        const today = new Date(dates.startDate);
        const endOfWeek = new Date(dates.endDate);

        const thisWeekEventsCount = this.events.filter(event => {
            if (!event.dateTime || !event.dateTime.start) return false;
            const eventDate = new Date(event.dateTime.start);
            return eventDate >= today && eventDate <= endOfWeek;
        }).length;

        // The view the app defaults to when all filters are cleared
        const defaultMode = thisWeekEventsCount > 0 ? 'this-week' : 'upcoming';

        // 2. Determine the "Current View"
        let currentMode;
        if (this.selectedCategory) {
            currentMode = 'category';
        } else if (this.searchQuery) {
            currentMode = 'search';
        } else if (this.showAllEvents) {
            currentMode = 'all';
        } else if (this.filters.locationQuery || this.filters.dateRange !== 'all' || this.filters.priceRange !== 'all') {
            currentMode = 'filtered';
        } else {
            // If no filters are active, the current view IS the default view
            currentMode = defaultMode;
        }

        // 3. Return the composite state object (always)
        return {
            current: currentMode,
            default: defaultMode,
            // isFiltered is true if the current view is NOT one of the default/global views
            isFiltered: currentMode !== 'this-week' && currentMode !== 'upcoming' && currentMode !== 'all'
        };
    },
    },


    methods: { 
            async viewEvent(eventId) {
            console.log('View event:', eventId);

            try {
                //Fetch the full event details with populated references
                const response = await fetch(`/api/events/${eventId}`)  // Fixed: added /
                if (!response.ok){
                    throw new Error('Failed to load event details');
                }

                this.selectedEvent = await response.json();
                console.log('Selected event:', this.selectedEvent);

                //Prevent body scroll
                document.body.classList.add('modal-open');
            } catch (err) {
                console.error('Error loading event:', err);
                alert('Could not load event details. Please try again.');
            }
        },
        

        closeEventDetail(){
            this.selectedEvent = null;
            //Re enable body scroll
            document.body.classList.remove('modal-open')
        },

        getThisWeekDates()
        {
            const today = new Date();
            //Set time to the start of the current day
            today.setHours(0, 0, 0, 0);

            //Calculate the date for the end of the 7th day from now (E.g if today is Tuesday the end date is the following monday at 23:59:59)
            const sevenDaysFromNow = new Date(today);
            sevenDaysFromNow.setDate(today.getDate() + 7);
            sevenDaysFromNow.setHours(23, 59, 59, 999)

            return{
                //Start date is NOW (Or start of today)
                startDate: today.toISOString(),
                endDate: sevenDaysFromNow.toISOString()
            };
        },

        async fetchEvents(){
            this.loading = true;
            this.error = null;

            //Build the query string using URLSearchParams
            const params = new URLSearchParams();

            //Determine if the "This week" filter should be applied
            const applyDefaultFilter = !this.searchQuery && !this.selectedCategory;

            if(this.searchQuery){
                params.append('search', this.searchQuery);
            }
            if (this.selectedCategory){
                params.append('category', this.selectedCategory);
            }

           const url = `/api/events?${params.toString()}`;

            //Only add 'search' parameter if searchQuery is not empty
            if (this.searchQuery){
                params.append('search', this.searchQuery)
            }
            //Only add 'category parameter if selectedCategory is not null
            if(this.selectedCategory){
                params.append('category', this.selectedCategory)
            }
            
            try{
                const response = await fetch(url)
                if (!response.ok){
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                this.events = await response.json();

                //Simulate adding a unique ID (Kept from original mouted hook)
                //this.events = this.events.map((e, index) => ({...e, _id: e._d || index}))
            } catch(err){
                this.error = 'Failed to fetch events:' + err.message;
            } finally {
                this.loading = false;
            }

            
        },

        getCategoryEmoji(category) {
            const emojis = {
                'Music & Concerts': 'üéµ',
                'Arts & Culture': 'üé®',
                'Food & Drink': 'üçï',
                'Sports & Fitness': 'üèÉ‚Äç‚ôÇÔ∏è',
                'Business & Tech': 'üíº',
                'Family & Kids': 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶'
            };
            return emojis[category] || 'üé™';
        },

        formatDate(dateTime) {
            if (!dateTime || !dateTime.start) return 'Date TBA';
            const date = new Date(dateTime.start);  // Fixed: was 'data'
            return date.toLocaleDateString('en-NZ', {
                weekday: 'short',
                month: 'short',
                day: 'numeric'
            });
        },

        getPrice(pricing) {
            if (!pricing) return 'Price TBA';
            if (pricing.isFree) return 'Free';
           
            //Handle Price ranges
            if (pricing.minPrice && pricing.maxPrice)
            {
                if (pricing.minPrice === pricing.maxPrice){
                    return `$${pricing.minPrice}` //Displays single price if they're the same as maximum price
                }

                return `$${pricing.minPrice} - $${pricing.maxPrice}`; //Range
            }

            //Just minimum price
            if (pricing.minPrice)
            {
                return `From $${pricing.minPrice}`
            }

            //Just Maximum (Unusual but people are weird)
            if (pricing.maxPrice) {
                return `Up to $${pricing.maxPrice}`
            }

            return 'Price TBA'
        },

        getLocation(location) {  // Fixed: was 'Location' (capital L)
            if (!location) return 'Location TBA';
            if (location.venueName) return location.venueName;
            if (location.address?.suburb) return location.address.suburb;
            return 'Location TBA';
        },

        filterByCategory(category) {
        if (this.selectedCategory === category) {
        this.selectedCategory = null;
        } else {
        this.selectedCategory = category;
        }
        },

        viewAllEvents() {
            this.showAllEvents = true;
            this.selectedCategory = null;
            this.searchQuery = '';
        },

        clearAllFilters() {
            this.showAllEvents = false;
            this.selectedCategory = null;
            this.searchQuery = '';
            this.filters = {
                dateRange: 'all',
                priceRange: 'all',
                locationQuery: ''
            };
        },
    

        clearFilter() {
            this.selectedCategory = null;
            this.fetchEvents();
        },

        clearAdvancedFilters() {
            this.filters = {
                dateRange: 'all',
                priceRange: 'all',
                locationQuery: ''
            };
        },

        async submitEvent() {
            this.submitting = true;
            this.submitError = null;
            this.submitSuccess = false;

            try {
                // Combine date and time into ISO format
                const eventDateTime = new Date(`${this.newEvent.date}T${this.newEvent.time}`).toISOString();
                
                // Create slug from title
                const slug = this.newEvent.title
                    .toLowerCase()
                    .trim()
                    .replace(/\s+/g, '-')
                    .replace(/[^\w\-]+/g, '')
                    .slice(0, 100);

                const payload = {
                    title: this.newEvent.title,
                    description: this.newEvent.description,
                    category: this.newEvent.category,
                    dateTime: {
                        start: eventDateTime
                    },
                    slug: slug,
                    venueName: this.newEvent.venueName,
                    organizerName: this.newEvent.organizerName,
                    pricing: {
                        isFree: this.newEvent.isFree,
                        minPrice: this.newEvent.isFree ? null : this.newEvent.minPrice,
                        maxPrice: this.newEvent.isFree ? null : this.newEvent.maxPrice
                    }
                };

                const response = await fetch('/api/events', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`Failed to create event: ${response.status}`);
                }

                const createdEvent = await response.json();
                
                // Add to local events array
                this.events.push(createdEvent);
                
                this.submitSuccess = true;
                
                // Reset form
                this.resetEventForm();
                
                // Redirect to home after 2 seconds
                setTimeout(() => {
                    window.location.hash = '/';
                    this.submitSuccess = false;
                }, 2000);

            } catch (err) {
                console.error('Submit error:', err);
                this.submitError = err.message;
            } finally {
                this.submitting = false;
            }
    },
    cancelCreate() {
        this.resetEventForm();
        window.location.hash = '/';
    },

    resetEventForm() {
        this.newEvent = {
            title: '',
            description: '',
            category: '',
            date: '',
            time: '',
            venueName: '',
            organizerName: '',
            isFree: false,
            minPrice: null,
            maxPrice: null
        };
    }
}  // methods object closes here
}).mount('#app');
</script>   
</body>
</html>