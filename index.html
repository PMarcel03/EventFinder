<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EventFinder - Discover Local Events</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #8b5cf6;
            --primary-dark: #7c3aed;
            --secondary-color: #06b6d4;
            --accent-color: #f59e0b;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --bg-color: #fafafa;
            --surface-color: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            --border-color: #e5e7eb;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --gradient: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* Vue App Structure */
        #app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header Component */
        .header {
            background: var(--gradient);
            color: white;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-lg);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.75rem;
            font-weight: 800;
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
        }

        .logo::before {
            content: "üé™";
            font-size: 1.5rem;
        }

        .nav {
            display: flex;
            gap: 1.5rem;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-link:hover,
        .nav-link.router-link-active {
            color: white;
            background-color: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .location-indicator {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.8);
        }

        /* Main Content Area - Vue Router View */
        .main-content {
            flex: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            width: 100%;
        }

        /* Vue Component Base Styles */
        .page-view {
            min-height: 400px;
        }

        .page-header {
            margin-bottom: 2rem;
            text-align: center;
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-subtitle {
            color: var(--text-secondary);
            font-size: 1.2rem;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Card Components for Vue */
        .card {
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-body {
            padding: 1.5rem;
        }

        .card-footer {
            padding: 1rem 1.5rem;
            background-color: #f9fafb;
            border-top: 1px solid var(--border-color);
        }

        /* Button Components */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--gradient);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background-color: var(--surface-color);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline {
            background-color: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        /* Form Components for Vue */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.875rem;
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgb(139 92 246 / 0.1);
        }

        /* Custom dropdown arrow for better visibility */
        .form-input[type="date"] {
            /* background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='4' width='18' height='18' rx='2' ry='2'%3E%3C/rect%3E%3Cline x1='16' y1='2' x2='16' y2='6'%3E%3C/line%3E%3Cline x1='8' y1='2' x2='8' y2='6'%3E%3C/line%3E%3Cline x1='3' y1='10' x2='21' y2='10'%3E%3C/line%3E%3C/svg%3E"); */
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.25rem;
        }

        .form-input[type="time"] {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cpolyline points='12 6 12 12 16 14'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.25rem;
        }

        .input-error {
            border-color: var(--danger-color) !important;
            box-shadow: 0 0 0 3px rgb(239 68 68 / 0.1) !important;
        }

        .form-error {
            color: var(--danger-color);
            font-size: 0.875rem;
            margin-top: 0.25rem;
            font-weight: 500;
        }

        /* Success and Error Message Styles */
        .submit-message {
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            font-weight: 600;
        }

        .submit-success {
            color: var(--success-color);
            background-color: #f0fdf4;
            border: 1px solid var(--success-color);
        }

        .submit-error {
            color: var(--danger-color);
            background-color: #fef2f2;
            border: 1px solid var(--danger-color);
        }


        /*Search Bar */
        .search-bar {
            position: relative;
            max-width: 500px;
            margin: 2rem auto;
        }

        .search-input {
            width: 100%;
            padding: 1rem 3rem 1rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 2rem;
            font-size: 1.1rem;
            box-shadow: var(--shadow);
        }

        .search-btn {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            background: var(--gradient);
            color: white;
            border: none;
            border-radius: 50%;
            width: 2.5rem;
            height: 2.5rem;
            cursor: pointer;
        }

        /* Event Card Components */
        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .event-card {
            background: var(--surface-color);
            border-radius: 1rem;
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .event-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-4px);
        }

        .event-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
        }

        .event-content {
            padding: 1.5rem;
        }

        .event-date {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background-color: #fef3c7;
            color: #92400e;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .event-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .event-description {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .event-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .event-location,
        .event-price {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .event-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .tag {
            padding: 0.25rem 0.75rem;
            background-color: #e0e7ff;
            color: var(--primary-color);
            border-radius: 9999px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        /* Filter Components */
        .filters-bar {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            margin-top: 2rem;
            box-shadow: var(--shadow);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        /* Stats/Categories Component */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .category-card {
            background: var(--surface-color);
            border: 2px solid var(--border-color);
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .category-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .category-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .category-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .category-count {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        /* Loading & Empty States */
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem;
        }

        .spinner {
            width: 2rem;
            height: 2rem;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        /* Vue Transition Classes */
        .fade-enter-active,
        .fade-leave-active {
            transition: opacity 0.3s ease;
        }

        .fade-enter-from,
        .fade-leave-to {
            opacity: 0;
        }

        .slide-enter-active,
        .slide-leave-active {
            transition: transform 0.3s ease;
        }

        .slide-enter-from {
            transform: translateX(100%);
        }

        .slide-leave-to {
            transform: translateX(-100%);
        }

        .nav {
            order: -1;
            width: 100%;
            justify-content: center;
            flex-wrap: wrap;
        }

        .main-content {
            padding: 1rem;
        }

        .page-title {
            font-size: 2rem;
        }

        .events-grid {
            grid-template-columns: 1fr;
        }

        .filters-grid {
            grid-template-columns: 1fr;
        }

        .categories-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: var(--surface-color);
            border-radius: 1rem;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 2.5rem;
            height: 2.5rem;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: all 0.2s ease;
            color: var(--text-primary);
        }

        .modal-close:hover {
            background: white;
            transform: scale(1.1);
        }

        .modal-body {
            padding: 2rem;
        }

        /* Prevent body scroll when modal is open */
        body.modal-open {
            overflow: hidden;
        }

        /* Utility Classes for Vue */
        .hidden { display: none; }
        .visible { display: block; }
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }

/* Tablet Styles (769px - 1024px) */
@media (max-width: 1024px) and (min-width: 769px) {
    .header-content {
        padding: 0.5rem 1rem;
        flex-wrap: nowrap;
        gap: 1rem;
    }

    .logo {
        font-size: 1.3rem;
        flex-shrink: 0;
    }

    .nav {
        flex: 1;
        justify-content: center;
        gap: 0.75rem;
    }

    .nav-link {
        padding: 0.4rem 0.6rem;
        font-size: 0.85rem;
    }

    .user-menu {
        flex-shrink: 0;
        gap: 0.5rem;
    }

    .location-indicator {
        display: none; /* Hide location on tablet */
    }

    .btn-small {
        padding: 0.4rem 0.8rem;
        font-size: 0.8rem;
    }
}

/* Mobile Styles (768px and below) - SIMPLIFIED */
@media (max-width: 768px) {
    .header {
        position: sticky;
        top: 0;
    }

    .header-content {
        padding: 0.5rem;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .logo {
        font-size: 1.2rem;
        order: 1;
    }

    .user-menu {
        order: 2;
        margin-left: auto;
    }

    .nav {
        order: 3;
        width: 100%;
        justify-content: space-around;
        gap: 0.25rem;
        margin-top: 0.25rem;
    }

    .nav-link {
        padding: 0.35rem 0.5rem;
        font-size: 0.8rem;
        flex: 1;
        text-align: center;
        min-width: 0;
    }

    /* Hide less important elements on mobile */
    .location-indicator {
        display: none; /* Hide location completely on mobile */
    }

    /* Simplify the sign in button */
    .btn-small {
        padding: 0.35rem 0.6rem;
        font-size: 0.75rem;
    }

    /* Clean up main content */
    .main-content {
        padding: 0.75rem;
    }

    .page-header {
        margin-bottom: 1.5rem;
    }

    .page-title {
        font-size: 1.5rem;
        margin-bottom: 0.25rem;
    }

    .page-subtitle {
        font-size: 0.9rem;
        line-height: 1.4;
    }

    /* Reduce spacing in categories */
    .categories-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
        margin: 1.5rem 0;
    }

    .category-card {
        padding: 1rem 0.75rem;
    }

    .category-icon {
        font-size: 1.25rem;
        margin-bottom: 0.25rem;
    }

    .category-name {
        font-size: 0.85rem;
    }

    .category-count {
        font-size: 0.75rem;
    }
}

 .mb-2 {
        margin-bottom: 1rem !important;
        padding: 0.5rem;
        background: #f8fafc;
        border-radius: 0.5rem;
        border: 1px solid var(--border-color);
    }

    .mb-2 > .tag {
        display: inline-block;
        margin-bottom: 0;
        padding: 0.4rem 0.75rem;
        font-size: 0.8rem;
        background: white;
        border: 1px solid var(--border-color);
    }

    .mb-2 .btn {
        width: auto;
        margin-left: 0.5rem !important;
        margin-top: 0;
        padding: 0.4rem 0.75rem;
        font-size: 0.8rem;
    }

    /* Stack only when necessary */
    @media (max-width: 480px) {
        .mb-2 {
            text-align: center;
        }
        
        .mb-2 .btn {
            display: block;
            width: 100%;
            margin-left: 0 !important;
            margin-top: 0.5rem;
        }
    }

/* Tablet specific fix */
@media (max-width: 1024px) and (min-width: 769px) {
    .mb-2 {
        margin-bottom: 1.5rem !important;
    }
    
    .mb-2 > .tag {
        font-size: 0.9rem;
        padding: 0.5rem 1rem;
    }
    
    .mb-2 .btn {
        font-size: 0.85rem;
        padding: 0.5rem 1rem;
    }
}

/* Extra small screens */
@media (max-width: 480px) {
    .header-content {
        padding: 0.4rem;
    }

    .logo {
        font-size: 1.1rem;
    }

    .nav-link {
        font-size: 0.75rem;
        padding: 0.3rem 0.4rem;
    }

    .btn-small {
        padding: 0.3rem 0.5rem;
        font-size: 0.7rem;
    }

    .page-title {
        font-size: 1.3rem;
    }
}
/*End of Mobile Optimisations */
    </style>
</head>
<body>
    <div id="app">
        <!-- Header Component (HeaderComponent.vue) -->
        <header class="header">
            <div class="header-content">
                <a href="#/" class="logo">EventFinder</a>
                
                <nav class="nav">
                    <a href="#/" class="nav-link">Home</a>
                    <a href="#/favorites" class="nav-link">My Favorites</a>
                    <a href="#/create" class="nav-link" style="background-color: rgba(255, 255, 255, 0.2); font-weight: 600;">+ Create Event</a>
                </nav>

                <div class="user-menu">
                    <div class="location-indicator">
                        üìç Auckland, NZ
                    </div>
                    <button class="btn btn-secondary btn-small">Sign In</button>
                </div>
            </div>
        </header>
  
        <!-- Main Content (Router View) -->
        <main class="main-content">
            <!-- Home View Component -->
            <div class="page-view" id="home-view">
                <div class="page-header">
                    <h1 class="page-title">Discover Amazing Local Events</h1>
                    <p class="page-subtitle">Find concerts, workshops, festivals, and more happening near you</p>
                </div>
                 <!-- Selected Category Banner -->
                  <div v-if="displayMode.isFiltered" class="mb-2" style="text-align: center; margin-bottom: 1rem;">
                    <span v-if="selectedCategory" class="tag" style="font-size: 1rem; padding: 0.5rem 1rem;">
                        üìÇ Filtered by: {{ selectedCategory }}
                    </span>
                    <span v-else-if="searchQuery" class="tag" style="font-size: 1rem; padding: 0.5rem 1rem;">
                        üîç Search results for: "{{ searchQuery }}"
                    </span>
                    <span v-else-if="displayMode.current === 'filtered'" class="tag" style="font-size: 1rem; padding: 0.5rem 1rem;">
                        ‚öôÔ∏è Advanced Filters Active
                    </span>
                    
                    <button @click="clearAllFilters" class="btn btn-small btn-outline" style="margin-left: 1rem;">
                        {{ displayMode.default === 'upcoming' ? 'Show Upcoming ‚úï' : 'Show This Week ‚úï' }}
                    </button>
                </div>
              
            <div v-else-if="showAllEvents" class="mb-2" style="text-align: center; margin-bottom: 1rem;">
                <span class="tag" style="font-size: 1rem; padding: 0.5rem 1rem; background-color: #dbeafe; color: #1e40af;">
                    üìÖ Showing all events
                </span>
                
                <button @click="clearAllFilters" class="btn btn-small btn-outline" style="margin-left: 1rem;">
                    {{ displayMode.default === 'upcoming' ? 'Show Upcoming ‚úï' : 'Show This Week ‚úï' }}
                </button>
            </div>
            <div v-else class="mb-2" style="text-align: center; margin-bottom: 1rem;">
                <span v-if="displayMode.current === 'this-week'" class="tag" style="font-size: 1rem; padding: 0.5rem 1rem; background-color: #d8c7fe; color: #240e92;">
                    üìÖ Showing events this week ({{ formatDate({start: getThisWeekDates().startDate}) }} - {{ formatDate({start: getThisWeekDates().endDate}) }})
                </span>
                <span v-else-if="displayMode.current === 'upcoming'" class="tag" style="font-size: 1rem; padding: 0.5rem 1rem; background-color: #dbeafe; color: #1e3a8a;">
                    üîÆ Showing upcoming events
                </span>
                <button @click="viewAllEvents" class="btn btn-small btn-outline" style="margin-left: 1rem;">
                    View All Events üìÖ
                </button>
            </div>
               

                <!-- Search Component -->
                <div class="search-bar">
                    <input type="text" 
                           class="search-input" 
                           placeholder="Search events, venues, or organizers..."
                           v-model="searchQuery">
                    <button class="search-btn">üîç</button>
                </div>

                <!-- Categories Component -->
                <div class="categories-grid">
                    <div class="category-card" @click="filterByCategory('Music & Concerts')">
                        <span class="category-icon">üéµ</span>
                        <div class="category-name">Music & Concerts</div>
                        <div class="category-count">{{ categoryCounts['Music & Concerts'] }} {{ categoryCounts['Music & Concerts'] === 1 ? 'event' : 'events' }}</div>
                    </div>
                    <div class="category-card" @click="filterByCategory('Arts & Culture')">
                        <span class="category-icon">üé®</span>
                        <div class="category-name">Arts & Culture</div>
                        <div class="category-count">{{ categoryCounts['Arts & Culture'] }} {{ categoryCounts['Arts & Culture'] === 1 ? 'event' : 'events' }}</div>
                    </div>
                    <div class="category-card" @click="filterByCategory('Food & Drink')">
                        <span class="category-icon">üçï</span>
                        <div class="category-name">Food & Drink</div>
                        <div class="category-count">{{ categoryCounts['Food & Drink'] }} {{ categoryCounts['Food & Drink'] === 1 ? 'event' : 'events' }}</div>
                    </div>
                    <div class="category-card" @click="filterByCategory('Sports & Fitness')">
                        <span class="category-icon">üèÉ‚Äç‚ôÇÔ∏è</span>
                        <div class="category-name">Sports & Fitness</div>
                        <div class="category-count">{{ categoryCounts['Sports & Fitness'] }} {{ categoryCounts['Sports & Fitness'] === 1 ? 'event' : 'events' }}</div>
                    </div>
                    <div class="category-card" @click="filterByCategory('Business & Tech')">
                        <span class="category-icon">üíº</span>
                        <div class="category-name">Business & Tech</div>
                        <div class="category-count">{{ categoryCounts['Business & Tech'] }} {{ categoryCounts['Business & Tech'] === 1 ? 'event' : 'events' }}</div>
                    </div>
                    <div class="category-card" @click="filterByCategory('Family & Kids')">
                        <span class="category-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                        <div class="category-name">Family & Kids</div>
                        <div class="category-count">{{ categoryCounts['Family & Kids'] }} {{ categoryCounts['Family & Kids'] === 1 ? 'event' : 'events' }}</div>
                    </div>
                </div>
            
                <div class ="events-grid">
                    <!--Loading State-->
                    <div v-if="loading" class="loading-spinner">
                        <div class="spinner"></div>
                    </div>

                    <!--Error State-->
                    <div v-else-if="error" class="empty-state">
                        <div class="empty-state-icon">‚ö†Ô∏è</div>
                        <p>Error loading events: {{error}}</p>
                    </div>

                    <!--Empty State-->
                    <div v-else-if="events.length === 0" class ="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <p>No events found</p>
                    </div>

                    <!--Event Cards-->
                    <div v-else v-for="event in filteredEvents" :key="event._id" class="event-card">
                        <div class="event-image">{{getCategoryEmoji(event.category)}}</div>
                        <div class="event-content">
                            <div class="event-date">üìÖ {{formatDate(event.dateTime)}}</div>
                            <h3 class="event-title">{{event.title}}</h3>
                            <p class="event-description">{{event.description || 'No description avaliable'}}</p>
                            <div class="event-meta">
                                <div class="event-location">üìç {{getLocation(event.location)}}</div>
                                <div class="event-price">üí∞ {{getPrice(event.pricing)}}</div>
                            </div>
                            <div class="event-tags">
                                <span class="tag">{{event.category}}</span>
                            </div>
                            <button class="btn btn-primary" @click="viewEvent(event._id)">View Details</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Create Event View -->
            <div class="page-view" id="create-event-view" v-show="currentRoute === '/create'">
                <div class="page-header">
                    <h1 class="page-title">Create New Event</h1>
                    <p class="page-subtitle">Share your event with the Auckland community</p>
                </div>

                <div class="card" style="max-width: 800px; margin: 0 auto;">
                    <div class="card-body">
                        <form @submit.prevent="submitEvent">
                            <div class="form-group">
                                <label class="form-label">Event Title *</label>
                                <input type="text" class="form-input" v-model="newEvent.title" required placeholder="e.g., Summer Music Festival">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <textarea class="form-textarea" v-model="newEvent.description" rows="4" placeholder="Tell people about your event..."></textarea>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Category *</label>
                                <select class="form-select" v-model="newEvent.category" required>
                                    <option value="">Select a category</option>
                                    <option>Music & Concerts</option>
                                    <option>Arts & Culture</option>
                                    <option>Food & Drink</option>
                                    <option>Sports & Fitness</option>
                                    <option>Business & Tech</option>
                                    <option>Family & Kids</option>
                                </select>
                            </div>

                        <div class="form-group">
                            <label class="form-label">Event Date *</label>
                            <input type="date" 
                                class="form-input" 
                                v-model="newEvent.date" 
                                @input="validateDateInput($event)"
                                @invalid="handleDateInvalid($event)"
                                required
                                ref="dateInput">
                        </div>
                                                                        
                            <div class="form-group">
                                <label class="form-label">Event Time *</label>
                                <input type="time" class="form-input" v-model="newEvent.time" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Venue Name *</label>
                                <input type="text" 
                                    class="form-input" 
                                    v-model="newEvent.venueName" 
                                    required 
                                    placeholder="e.g., Western Springs Stadium"
                                    :class="{ 'input-error': !newEvent.venueName && formTouched }">
                                <div v-if="!newEvent.venueName && formTouched" class="form-error">Venue name is required</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Organizer Name *</label>
                                <input type="text" 
                                    class="form-input" 
                                    v-model="newEvent.organizerName" 
                                    required 
                                    placeholder="e.g., Auckland Live Events"
                                    :class="{ 'input-error': !newEvent.organizerName && formTouched }">
                                <div v-if="!newEvent.organizerName && formTouched" class="form-error">Organizer name is required</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Is this a free event?</label>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" v-model="newEvent.isFree" id="isFree">
                                    <label for="isFree" style="margin: 0; font-weight: normal;">Yes, this event is free</label>
                                </div>
                            </div>

                            <div class="form-group" v-if="!newEvent.isFree">
                                <label class="form-label">Price Range</label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div>
                                        <input type="number" class="form-input" v-model.number="newEvent.minPrice" placeholder="Min Price ($)" min="0">
                                    </div>
                                    <div>
                                        <input type="number" class="form-input" v-model.number="newEvent.maxPrice" placeholder="Max Price ($)" min="0">
                                    </div>
                                </div>
                            </div>

                            <!-- Success and Error Messages -->
                            <div v-if="submitError" class="mt-2" style="color: var(--danger-color); font-weight: 600; padding: 1rem; background-color: #fef2f2; border-radius: 0.5rem; border: 1px solid var(--danger-color);">
                                ‚ö†Ô∏è {{ submitError }}
                            </div>
                            
                            <div v-if="submitSuccess" class="mt-2" style="color: var(--success-color); font-weight: 600; padding: 1rem; background-color: #f0fdf4; border-radius: 0.5rem; border: 1px solid var(--success-color);">
                                ‚úÖ Event created successfully! Redirecting to home page...
                            </div>

                            <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                                <button type="submit" class="btn btn-primary" :disabled="submitting">
                                    {{ submitting ? 'Creating...' : 'Create Event üéâ' }}
                                </button>
                                <button type="button" class="btn btn-secondary" @click="cancelCreate">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>


                <!-- Filters Component -->
                <div class="filters-bar">
                    <div class="filters-grid">
                        <div class="form-group">
                            <label class="form-label">Date Range</label>
                            <select class="form-select" v-model="filters.dateRange">
                                <option value="all">All Dates</option>
                                <option value="today">Today</option>
                                <option value="tomorrow">Tomorrow</option>
                                <option value="this-weekend">This Weekend</option>
                                <option value="next-week">Next Week</option>
                                <option value="this-month">This Month</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Price Range</label>
                            <select class="form-select" v-model="filters.priceRange">
                                <option value="all">All Prices</option>
                                <option value="free">Free</option>
                                <option value="under-25">Under $25</option>
                                <option value="25-50">$25 - $50</option>
                                <option value="50-100">$50 - $100</option>
                                <option value="over-100">$100+</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Location</label>
                            <input type="text" class="form-input" v-model="filters.locationQuery" placeholder="Enter suburb or venue">
                        </div>
                        <div class="form-group" style="display: flex; align-items: flex-end;">
                            <button @click="clearAdvancedFilters" class="btn btn-outline" style="width: 100%;">
                                Clear All Filters
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Event Detail Modal -->
                <div v-if="selectedEvent" class="modal-overlay" @click="closeEventDetail">
                    <div class="modal-content" @click.stop>
                        <button class="modal-close" @click="closeEventDetail">‚úï</button>
                        
                        <div class="event-image" style="height: 250px;">
                            {{ getCategoryEmoji(selectedEvent.category) }}
                        </div>
                        
                        <div class="modal-body">
                            <div class="event-date mb-2">üìÖ {{ formatDate(selectedEvent.dateTime) }}</div>
                            <h1 class="event-title" style="font-size: 2rem;">{{ selectedEvent.title }}</h1>
                            
                            <div class="event-meta mb-3" style="justify-content: flex-start; gap: 2rem;">
                                <div class="event-location">üìç {{ getLocation(selectedEvent.location) }}</div>
                                <div class="event-price">üí∞ {{ getPrice(selectedEvent.pricing) }}</div>
                            </div>
                            
                            <div class="event-tags mb-3">
                                <span class="tag">{{ selectedEvent.category }}</span>
                            </div>
                            
                            <div class="mb-3">
                                <h3 style="margin-bottom: 0.5rem; font-size: 1.1rem;">About this event</h3>
                                <p class="event-description">
                                    {{ selectedEvent.description || 'No description available.' }}
                                </p>
                            </div>
                            
                            <div v-if="selectedEvent.organizer" class="mb-3">
                                <h3 style="margin-bottom: 0.5rem; font-size: 1.1rem;">Organizer</h3>
                                <p style="color: var(--text-secondary);">
                                    {{ selectedEvent.organizer.name || 'Organizer information not available' }}
                                </p>
                            </div>
                            
                            <div v-if="selectedEvent.location?.venueId" class="mb-3">
                                <h3 style="margin-bottom: 0.5rem; font-size: 1.1rem;">Venue Details</h3>
                                <p style="color: var(--text-secondary);">
                                    <strong>{{ selectedEvent.location.venueId.name }}</strong><br>
                                    <span v-if="selectedEvent.location.venueId.address">
                                        {{ selectedEvent.location.venueId.address.street }}<br>
                                        {{ selectedEvent.location.venueId.address.suburb }}, {{ selectedEvent.location.venueId.address.city }}
                                    </span>
                                </p>
                            </div>
                            
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                <button class="btn btn-primary">Add to Favorites ‚ù§Ô∏è</button>
                                <button class="btn btn-secondary">Share Event üì§</button>
                                <button class="btn btn-outline">Get Directions üó∫Ô∏è</button>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
            </div>

        </main>
    </div>

<script>
const {createApp, computed} = Vue;

createApp({
    data() {
        return {
            //Core data Models
            events: [],
            selectedEvent: null,
            
            //UI State Models
            loading: true,
            error: null,
            submitting: false,
            submitError: null,
            submitSuccess: false,

            //Controller State Models
            currentRoute: window.location.hash.slice(1) || '/',
            selectedCategory: null,
            searchQuery: '',
            showAllEvents: false,
          
            
            //Filter Models
            filters: {
                dateRange: 'all',
                priceRange: 'all',
                locationQuery: ''

            },
            //Form Models
            newEvent: {
                title: '',
                description: '',
                category: '',
                dateTime: '',
                venueName: '',
                organizerName: '',
                isFree: false,
                minPrice: null,
                maxPrice: null
            },
            formTouched: false, // Add this
        }
    },
    async mounted() {
       //--- ROUTING SETUP ---
       //Listen for hash changes (e.g when a user clicks a nav link)
       window.addEventListener('hashchange', () => {
        this.currentRoute = window.location.hash.slice(1) || '/'
       });

       //Close modal on esc key
       window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && this.selectedEvent){
            this.closeEventDetail();
        }
       })

       //--- DATA FETCHING ---
    await this.fetchEvents();
    },

    computed: {
        currentview(){
            //Maps hash path to an element ID/Name to be displayed
            if (this.currentRoute === '' || this.currentRoute === '/' || this.currentRoute.startsWith('/events')) return 'home-view';
            //if (this.currentRoute.startsWith('/events')) return 'events-view';
            //if (this.currentRoute.startsWith('/categories')) return 'categories-view';
            if (this.currentview.startsWith('/favourites')) return 'favourites-view';

            //Fallback: Could be a dedicated 404 view
            return 'home-view';
        },

        filteredEvents() {
            let events = this.events;
            console.log('Starting with events:', events.length);

            // 1. Category filter (from category cards)
            if (this.selectedCategory) {
                events = events.filter(event => event.category === this.selectedCategory);
            }
            
            // 2. Search query filter
            if (this.searchQuery && this.searchQuery.trim() !== '') {
                const search = this.searchQuery.toLowerCase();
                events = events.filter(event =>
                    event.title.toLowerCase().includes(search) ||
                    (event.description && event.description.toLowerCase().includes(search)) ||
                    (event.location?.venueName && event.location.venueName.toLowerCase().includes(search))
                );
            }
            
            // 3. Location filter
            if (this.filters.locationQuery && this.filters.locationQuery.trim() !== '') {
                const location = this.filters.locationQuery.toLowerCase();
                events = events.filter(event =>
                    (event.location?.venueName && event.location.venueName.toLowerCase().includes(location)) ||
                    (event.location?.address?.suburb && event.location.address.suburb.toLowerCase().includes(location)) ||
                    (event.location?.address?.city && event.location.address.city.toLowerCase().includes(location))
                );
            }
            
            // 4. Price range filter
            if (this.filters.priceRange !== 'all') {
                events = events.filter(event => {
                    const pricing = event.pricing;
                    
                    if (this.filters.priceRange === 'free') {
                        return pricing?.isFree === true;
                    }
                    
                    // For paid events, check min/max price
                    const minPrice = pricing?.minPrice || 0;
                    const maxPrice = pricing?.maxPrice || minPrice;
                    
                    switch(this.filters.priceRange) {
                        case 'under-25':
                            return !pricing?.isFree && maxPrice < 25;
                        case '25-50':
                            return !pricing?.isFree && minPrice >= 25 && maxPrice <= 50;
                        case '50-100':
                            return !pricing?.isFree && minPrice >= 50 && maxPrice <= 100;
                        case 'over-100':
                            return !pricing?.isFree && minPrice >= 100;
                        default:
                            return true;
                    }
                });
            }
            
            // 5. Advanced Date range filter (from filters bar)
            if (this.filters.dateRange !== 'all') {
                const now = new Date();
                
                events = events.filter(event => {
                    if (!event.dateTime || !event.dateTime.start) return false;
                    
                    const eventDate = new Date(event.dateTime.start);
                    
                    // Convert both dates to NZ timezone for accurate comparison
                    const nzOffset = 12 * 60 * 60 * 1000; // NZ is UTC+12
                    
                    // Create dates in NZ timezone
                    const nzNow = new Date(now.getTime() + nzOffset);
                    const nzEventDate = new Date(eventDate.getTime() + nzOffset);
                    
                    // Set to start of day for date comparison
                    const startOfToday = new Date(nzNow);
                    startOfToday.setUTCHours(0, 0, 0, 0);
                    
                    const startOfEventDay = new Date(nzEventDate);
                    startOfEventDay.setUTCHours(0, 0, 0, 0);
                    
                    // Calculate day of week once for all cases that need it
                    const dayOfWeek = startOfToday.getUTCDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday
                    
                    switch(this.filters.dateRange) {
                        case 'today':
                            return startOfEventDay.getTime() === startOfToday.getTime();
                            
                        case 'tomorrow':
                            const startOfTomorrow = new Date(startOfToday);
                            startOfTomorrow.setUTCDate(startOfTomorrow.getUTCDate() + 1);
                            return startOfEventDay.getTime() === startOfTomorrow.getTime();
                            
                        case 'this-weekend':
                            const daysUntilSaturday = dayOfWeek === 0 ? 6 : 6 - dayOfWeek; // Saturday is day 6
                            const daysUntilSunday = dayOfWeek === 0 ? 0 : 7 - dayOfWeek;   // Sunday is day 0
                            
                            const saturday = new Date(startOfToday);
                            saturday.setUTCDate(saturday.getUTCDate() + daysUntilSaturday);
                            
                            const sunday = new Date(startOfToday);
                            sunday.setUTCDate(sunday.getUTCDate() + daysUntilSunday);
                            
                            return startOfEventDay.getTime() === saturday.getTime() || 
                                startOfEventDay.getTime() === sunday.getTime();
                            
                        case 'next-week':
                            const nextWeekStart = new Date(startOfToday);
                            // Move to next Monday
                            const daysUntilNextMonday = dayOfWeek === 0 ? 1 : 8 - dayOfWeek;
                            nextWeekStart.setUTCDate(nextWeekStart.getUTCDate() + daysUntilNextMonday);
                            
                            const nextWeekEnd = new Date(nextWeekStart);
                            nextWeekEnd.setUTCDate(nextWeekEnd.getUTCDate() + 6); // End of next Sunday
                            nextWeekEnd.setUTCHours(23, 59, 59, 999);
                            
                            return startOfEventDay >= nextWeekStart && startOfEventDay <= nextWeekEnd;
                            
                        case 'this-month':
                            const currentMonth = startOfToday.getUTCMonth();
                            const currentYear = startOfToday.getUTCFullYear();
                            return startOfEventDay.getUTCMonth() === currentMonth && 
                                startOfEventDay.getUTCFullYear() === currentYear;
                            
                        default:
                            return true;
                    }
                });
            }
            
            // 6. Default view filtering (only apply if no other filters are active)
            const hasActiveFilters = this.selectedCategory || 
                                    this.searchQuery || 
                                    this.filters.locationQuery ||
                                    this.filters.dateRange !== 'all' ||
                                    this.filters.priceRange !== 'all';
            
            if (!hasActiveFilters && !this.showAllEvents) {
                // Apply default "this week" or "upcoming" filter
                const dates = this.getThisWeekDates();
                const today = dates.startDate;
                const endOfWeek = dates.endDate;
                
                console.log('=== DEBUG: Default View Filter ===');
                console.log('Week start:', today.toISOString(), today.toLocaleString("en-NZ"));
                console.log('Week end:', endOfWeek.toISOString(), endOfWeek.toLocaleString("en-NZ"));
                
                const thisWeekEvents = events.filter(event => {
                    if (!event.dateTime || !event.dateTime.start) return false;
                    return this.isDateInRange(event.dateTime.start, today, endOfWeek);
                });

                console.log('This week events count:', thisWeekEvents.length);
                
                if (thisWeekEvents.length === 0) {
                    console.log('No events this week, showing upcoming events');
                    events = events.filter(event => {
                        if (!event.dateTime || !event.dateTime.start) return false;
                        const eventDate = new Date(event.dateTime.start);
                        return eventDate >= today;
                    });
                } else {
                    events = thisWeekEvents;
                }
            }

            console.log('Filtered events count:', events.length);
            return events;
        },

        categoryCounts: {
            get() {
                const counts = {};
                const categories = [
                    'Music & Concerts', 
                    'Arts & Culture', 
                    'Food & Drink', 
                    'Sports & Fitness', 
                    'Business & Tech', 
                    'Family & Kids'
                ];
                
                // Initialize all categories with 0
                categories.forEach(cat => counts[cat] = 0);
                
                // Count events for each category from filteredEvents
                this.filteredEvents.forEach(event => {
                    if (event.category && counts.hasOwnProperty(event.category)) {
                        counts[event.category]++;
                    }
                });
                
                return counts;
            }
        },

        
        displayMode(){
            // 1. Determine the "Default View" (what happens when no filters are active)
            const dates = this.getThisWeekDates();
            const today = dates.startDate;
            const endOfWeek = dates.endDate;

            const thisWeekEventsCount = this.events.filter(event => {
                if (!event.dateTime || !event.dateTime.start) return false;
                return this.isDateInRange(event.dateTime.start, today, endOfWeek);
            }).length;

            // The view the app defaults to when all filters are cleared
            const defaultMode = thisWeekEventsCount > 0 ? 'this-week' : 'upcoming';

            // 2. Determine the "Current View"
            let currentMode;
            if (this.selectedCategory) {
                currentMode = 'category';
            } else if (this.searchQuery) {
                currentMode = 'search';
            } else if (this.showAllEvents) {
                currentMode = 'all';
            } else if (this.filters.locationQuery || this.filters.dateRange !== 'all' || this.filters.priceRange !== 'all') {
                currentMode = 'filtered';
            } else {
                // If no filters are active, the current view IS the default view
                currentMode = defaultMode;
            }

            // 3. Return the composite state object (always)
            return {
                current: currentMode,
                default: defaultMode,
                // isFiltered is true if the current view is NOT one of the default/global views
                isFiltered: currentMode !== 'this-week' && currentMode !== 'upcoming' && currentMode !== 'all'
            };
        }
    },


    methods: { 
            async viewEvent(eventId) {
            console.log('View event:', eventId);

            try {
                //Fetch the full event details with populated references
                const response = await fetch(`/api/events/${eventId}`)  // Fixed: added /
                if (!response.ok){
                    throw new Error('Failed to load event details');
                }

                this.selectedEvent = await response.json();
                console.log('Selected event:', this.selectedEvent);

                //Prevent body scroll
                document.body.classList.add('modal-open');
            } catch (err) {
                console.error('Error loading event:', err);
                alert('Could not load event details. Please try again.');
            }
        },

        closeEventDetail(){
            this.selectedEvent = null;
            //Re enable body scroll
            document.body.classList.remove('modal-open')
        },

        getThisWeekDates() {
            // Get current date
            const now = new Date();
            
            // Get the timezone offset for NZ (UTC+12 hours in milliseconds)
            // We'll use a fixed offset since NZ is UTC+12
            const nzOffset = 12 * 60 * 60 * 1000; // 12 hours in milliseconds
            
            // Adjust current time to NZ time
            const nzNow = new Date(now.getTime() + nzOffset);
            
            // Start of today in NZ time (set to midnight)
            const startOfToday = new Date(nzNow);
            startOfToday.setUTCHours(0, 0, 0, 0);
            
            // Get day of week (0 = Sunday, 1 = Monday, ...)
            const dayOfWeek = startOfToday.getUTCDay();
            
            // Calculate start of week (Monday)
            const startOfWeek = new Date(startOfToday);
            const diffToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
            startOfWeek.setUTCDate(startOfToday.getUTCDate() + diffToMonday);
            
            // End of week (Sunday)
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setUTCDate(startOfWeek.getUTCDate() + 6);
            endOfWeek.setUTCHours(23, 59, 59, 999);
            
            // Convert back to local time for comparison with event dates
            const startLocal = new Date(startOfWeek.getTime() - nzOffset);
            const endLocal = new Date(endOfWeek.getTime() - nzOffset);
            
            console.log('NZ This week range:', {
                start: startLocal.toISOString(),
                end: endLocal.toISOString(),
                startNZ: startLocal.toLocaleString("en-NZ", { timeZone: "Pacific/Auckland" }),
                endNZ: endLocal.toLocaleString("en-NZ", { timeZone: "Pacific/Auckland" })
            });
            
            return {
                startDate: startLocal,
                endDate: endLocal
            };
        },

        isDateInRange(eventDate, startDate, endDate) {
            try {
                // Parse the dates
                const eventDateObj = new Date(eventDate);
                const startDateObj = new Date(startDate);
                const endDateObj = new Date(endDate);
                
                // Check if dates are valid
                if (isNaN(eventDateObj.getTime()) || isNaN(startDateObj.getTime()) || isNaN(endDateObj.getTime())) {
                    console.error('Invalid date in range comparison');
                    return false;
                }
                
                // Compare dates (including time)
                return eventDateObj >= startDateObj && eventDateObj <= endDateObj;
            } catch (error) {
                console.error('Error in date range comparison:', error);
                return false;
            }
        },

        


        async fetchEvents(){
            this.loading = true;
            this.error = null;

            //Build the query string using URLSearchParams
            const params = new URLSearchParams();

            //Determine if the "This week" filter should be applied
            const applyDefaultFilter = !this.searchQuery && !this.selectedCategory;

            if(this.searchQuery){
                params.append('search', this.searchQuery);
            }
            if (this.selectedCategory){
                params.append('category', this.selectedCategory);
            }

           const url = `/api/events?${params.toString()}`;

            //Only add 'search' parameter if searchQuery is not empty
            if (this.searchQuery){
                params.append('search', this.searchQuery)
            }
            //Only add 'category parameter if selectedCategory is not null
            if(this.selectedCategory){
                params.append('category', this.selectedCategory)
            }
            
            try{
                const response = await fetch(url)
                if (!response.ok){
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                this.events = await response.json();

                //Simulate adding a unique ID (Kept from original mouted hook)
                //this.events = this.events.map((e, index) => ({...e, _id: e._d || index}))
            } catch(err){
                this.error = 'Failed to fetch events:' + err.message;
            } finally {
                this.loading = false;
            }

            
        },

        getCategoryEmoji(category) {
            const emojis = {
                'Music & Concerts': 'üéµ',
                'Arts & Culture': 'üé®',
                'Food & Drink': 'üçï',
                'Sports & Fitness': 'üèÉ‚Äç‚ôÇÔ∏è',
                'Business & Tech': 'üíº',
                'Family & Kids': 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶'
            };
            return emojis[category] || 'üé™';
        },

        formatDate(dateTime) {
            if (!dateTime || !dateTime.start) return 'Date TBA';

            try{
                //Parse date string and force NZ timezone
                const date = new Date(dateTime.start);

                //Use localestring with explicit NZ timezone
                return date.toLocaleDateString('en-NZ', {
                    weekday:'short',
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric',
                    timeZone: 'Pacific/Auckland'
                });
            } catch (error){
                console.error('Date formatting error:', error);
                return 'Date TBA'
            }
        
        },

        getPrice(pricing) {
            if (!pricing) return 'Price TBA';
            if (pricing.isFree) return 'Free';
           
            //Handle Price ranges
            if (pricing.minPrice && pricing.maxPrice)
            {
                if (pricing.minPrice === pricing.maxPrice){
                    return `$${pricing.minPrice}` //Displays single price if they're the same as maximum price
                }

                return `$${pricing.minPrice} - $${pricing.maxPrice}`; //Range
            }

            //Just minimum price
            if (pricing.minPrice)
            {
                return `From $${pricing.minPrice}`
            }

            //Just Maximum (Unusual but people are weird)
            if (pricing.maxPrice) {
                return `Up to $${pricing.maxPrice}`
            }

            return 'Price TBA'
        },

        getLocation(location) {  // Fixed: was 'Location' (capital L)
            if (!location) return 'Location TBA';
            if (location.venueName) return location.venueName;
            if (location.address?.suburb) return location.address.suburb;
            return 'Location TBA';
        },

        filterByCategory(category) {
        if (this.selectedCategory === category) {
        this.selectedCategory = null;
        } else {
        this.selectedCategory = category;
        }
        },

        viewAllEvents() {
            this.showAllEvents = true;
            this.selectedCategory = null;
            this.searchQuery = '';
        },

        clearAllFilters() {
            this.showAllEvents = false;
            this.selectedCategory = null;
            this.searchQuery = '';
            this.filters = {
                dateRange: 'all',
                priceRange: 'all',
                locationQuery: ''
            };
        },
    

        clearFilter() {
            this.selectedCategory = null;
            this.fetchEvents();
        },

        clearAdvancedFilters() {
            this.filters = {
                dateRange: 'all',
                selectedCategory:  null,
                searchQuery: '',
                priceRange: 'all',
                locationQuery: ''
            };
        },

        validateForm() {
            this.formTouched = true;
            return this.newEvent.title && 
                this.newEvent.category && 
                this.newEvent.date && 
                this.newEvent.time && 
                this.newEvent.venueName && 
                this.newEvent.organizerName;
        },

        async submitEvent() {
            if (!this.validateForm()) {
                this.submitError = 'Please fill in all required fields';
                return;
            }

            this.submitting = true;
            this.submitError = null;
            this.submitSuccess = false;

            try {
                // Validate required fields
                if (!this.newEvent.venueName.trim()) {
                    throw new Error('Venue name is required');
                }
                if (!this.newEvent.organizerName.trim()) {
                    throw new Error('Organizer name is required');
                }

                const selectedDate = new Date(this.newEvent.date);
                const selectedYear = selectedDate.getFullYear();
                const currentYear = new Date().getFullYear();

                if (selectedYear < 2020 || selectedYear > currentYear + 2) {
                    throw new Error(`Please select a date between 2020 and ${currentYear + 2}`);
                }

                // Create date in NZ timezone explicitly
                const dateString = `${this.newEvent.date}T${this.newEvent.time}:00`;
                const localDate = new Date(dateString);

                // Combine date and time into ISO format
                const eventDateTime = localDate.toISOString();
                
                // Create slug from title
                const slug = this.newEvent.title
                    .toLowerCase()
                    .trim()
                    .replace(/\s+/g, '-')
                    .replace(/[^\w\-]+/g, '')
                    .slice(0, 100);

                const payload = {
                    title: this.newEvent.title,
                    description: this.newEvent.description,
                    category: this.newEvent.category,
                    dateTime: {
                        start: eventDateTime
                    },
                    slug: slug,
                    // Update venue structure to match your Event model
                    location: {
                        venueName: this.newEvent.venueName
                    },
                    // Update organizer structure
                    organizerName: this.newEvent.organizerName,
                    pricing: {
                        isFree: this.newEvent.isFree,
                        minPrice: this.newEvent.isFree ? null : this.newEvent.minPrice,
                        maxPrice: this.newEvent.isFree ? null : this.newEvent.maxPrice
                    }
                };

                const response = await fetch('/api/events', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `Failed to create event: ${response.status}`);
                }

                const createdEvent = await response.json();
                
                // Add to local events array
                this.events.push(createdEvent);
                
                this.submitSuccess = true;
                
                // Reset form
                this.resetEventForm();
                
                // Redirect to home after 2 seconds
                setTimeout(() => {
                    window.location.hash = '/';
                    this.submitSuccess = false;
                }, 2000);

            } catch (err) {
                    console.error('Submit error:', err);
                    this.submitError = err.message;
                    this.submitSuccess = false; // Ensure success is false on error
                } finally {
                    this.submitting = false;
                }
        },

        validateDateInput(event) {
            const input = event.target;
            const selectedDate = new Date(input.value);
            const selectedYear = selectedDate.getFullYear();
            const currentYear = new Date().getFullYear();

            // Clear any previous custom message
            input.setCustomValidity('');

            // Only validate if there's a value
            if (input.value) {
                if (selectedYear < 2020 || selectedYear > currentYear + 2) {
                    input.setCustomValidity(`Please select a date between 2020 and ${currentYear + 2}`);
                } else {
                    input.setCustomValidity(''); // Clear if valid
                }
            }

            // Force re-validation
            input.reportValidity();
        },

        handleDateInvalid(event) {
            const input = event.target;
            
            // If the browser says it's invalid but we have a custom message, use ours
            if (input.validity.customError && input.validationMessage) {
                // Our custom message is already set, let it show
                return;
            }
            
            // Otherwise, set a better default message
            if (input.validity.valueMissing) {
                input.setCustomValidity('Please select an event date');
            } else {
                input.setCustomValidity('Please select a valid date');
            }
        },

        cancelCreate() {
            this.resetEventForm();
            window.location.hash = '/';
        },

        resetEventForm() {
            this.newEvent = {
                title: '',
                description: '',
                category: '',
                date: '',
                time: '',
                venueName: '',
                organizerName: '',
                isFree: false,
                minPrice: null,
                maxPrice: null
            };
        }
}  // methods object closes here
}).mount('#app');
</script>   
</body>
</html>